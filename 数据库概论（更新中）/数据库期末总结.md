<img src="D:\Typora_CACHE\image-20220617231354844.png" alt="image-20220617231354844" style="zoom:80%;" />

# 1.数据库系统介绍

## 1.1基础概念

### 1数据

the basic object stored in the computer

the symbol record depicting the objects that  exists objectively

Data type digit, text, graph, image, audio, video, etc.

### 2.数据库

A shared collection of **logically related** data,  and a description of this data, designed to  meet the information needs of an organization. 

including two types of data: 
**User data, Logically related data** comprises entities,  attributes, and relationships of an organization’s  information. e.g. Grade=90 
**Metadata** (System catalog , data dictionary) is the  ‘data about data’and provides description of  data, e.g. int grade;

### 3.数据库管理系统DBMS

A **software system** that enables users to define,  create, maintain and control access to this  database. 

The DBMS is the software that **interacts** with  the users’ application program and the  **database**. 

Commercial DBMS：DB2、Oracle、 SQL  Server 

Open Source DBMS： MySQL

### DBMS的功能

#### 1.Data definition language（DDL）

#### 2.Data Manipulation Language (DML)

#### 3.安全系统、完整性系统、并发控制系统、恢复控制系统

### 4.数据库系统DBS

It is a computer system using DB technique 

Components of DBS  
Hardware 
Can range from a PC to a network of computers. 

Software 
operating system, DBMS, network software (if  necessary), High-level Programming Language,  Compiling system, Application development tools and  also the application programs. 

### 数据库系统历史

First-generation (middle of 1960s) 
– **Hierarchical** (IBM---IMS) ：Tree Structure 
– **Network** (DBTG---DBTG report, 1965-1971) ：Graph Structure 

Second generation (1970, E.F. Codd)
 – **Relational** (IBM-System R， UCB- INGRES) 

Third generation (1980s-1990s) 
– **Object-Oriented** (OODB) （combine OO with DB, 1980s, fail） 
– **Object Relational** (ORDBS) （ introduce OO to RDB，Postgres） 

New Trend (after 1990s) 
– **Semi-structured DBS** (based on XML DM )

## 1.2数据管理技术的发展历史

Data Management is to classify, organize, encode, store, retrieve and maintain data. 

### 1.Manual System (before the mid-1950s )

**Background** 
Software: no OS or specified software 
Hardware: no direct access device ,e.g. disk only punched tape, magnetic tape and card.

**Features**: 
Data can not be kept for a long time 
Program manages data 
Data can not be shared 
Data dependence

### 2.Traditional File-Based System(1950s-1960s)

A collection of application programs that perform  services for the end users (e.g. reports).

**Background** 
Hardware: Direct access device, e.g. disk, memory drum  
Software: OS—file system

**Features (Outperform Manual System)** 
Data can be kept for a long time, I, D,U, S  operation 
File system manages data

File structure is defined inside the application code, known  as **program-data dependence** (programs depend on data).

### 3.Database System (after the mid-1960s )

DBS is much better than the file-based approach 
**Features of DBS** 
Data Structuring 
High degree of data sharing, low degree of data  redundancy 
High degree of Data independence 
Data can be managed and controlled unifiedly by  DBMS

##### (1) Data Structuring 

Data is for the entire enterprise, not for only one  application 
Both Internal and external data structuring,  relationship among data 
The length of the data record is variable. 
The smallest access unit is **data item**. 
Data is described by **data model**, not in the  application program.

(2) High degree of data sharing, low degree
of data redundancy
Reduce data redundancy, save the storage
space
Avoid the **incompatibility** （**float & int**）and
**inconsistency** (**stored more than once** ) of the
data.

(3) High degree of Data independence
-Logical Data independence
-Physical Data independence

(4) Data can be managed and controlled
unifiedly by DBMS.
– security protection (priviledge )
– integrity check (**correctness, validity**
**and consistency**)
– concurrency control
– database recovery

## 1.3数据模型

### 1.定义

**Model** is a simulation of ‘real world’ objects and event,
and their associations.
e.g. Aeromodelling( 航模) plane

**Data Model**
-a kind of model
-an abstract of data feature in the real world
-**【definition 】**An integrated collection of concepts
for describing and manipulating data, relationships
between data, and constraints on the data in an
organization.
-**Data Model is a simulation of Real world.**

### 2.数据模型的三个部分

Data Model comprises:
-a structural part （**Data Structure** ）;
-a manipulative part （**Data Manipulation** ）;
	query
	modify (insert, delete, update)
-a set of **integrity rules**.
	It is a set of rules (constraints) which ensure
that the data is accurate.
	**Integrity=correctness + validity+ consistency**

### 3.两种数据类型

-Conceptual Model (called Information Model )
It builds models for data and information according to the view
of users. It is used to design the database.

Structural Data Model (called Data Model )
-**Logical data model**
	• It builds models for data and information according to the
**view of computer systems**.
	• It is used to implement DBMS.
-**Physical data model**
	• PM is the lowest layer of abstract of data.
	• It describes the ways of data representation and data access in
computer system.
	• It is the task of DBMS to implement PM.

<img src="D:\Typora_CACHE\image-20220521103000334.png" alt="image-20220521103000334" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521103057796.png" alt="image-20220521103057796" style="zoom:50%;" />

#### 1.概念建模

**Conceptual modelling**, or **conceptual database design**, is process of developing a model of information, which is independent of implementation details, such as the target DBMS, application programs, programming
languages, or any other physical considerations.
Its result is a **conceptual data model**.
Conceptual model is **independent of DBMS** and **all implementation details (DBMS-independent)**.
*Entity-Relationship Approach ，called E-R model*

#### 2.逻辑建模

**Logical data model** assumes that we know the underlying data model of the **target DBMS**,
which maybe is:
• Hierarchical model---**Tree**
• Network model---**Graph**
• Relational model—**2D tables**
• Object-oriented data model
• Object Relational data model
• Semi-structured data model

## 1.4数据库系统体系结构

### 1.模式

The overall structure of the database is called the schema.
It describes the **types** of DB, not the concrete values.
It is relatively **stable**, whereas value is varying.

### 2.实例

The data in DB at any particular point in time is called a database instance.—the concrete **value** of a schema
One schema can have many instances.
Instance **varies** along with the modified data / flying time.

### 3.ANSI-SPARC 三层结构

<img src="D:\Typora_CACHE\image-20220521104020139.png" alt="image-20220521104020139" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521113333868.png" alt="image-20220521113333868" style="zoom:50%;" />

#### 1.概念模式

Conceptual Schema （Logical schema, or Schema. ）
– It represents the **global logical structure** of the entire database, it is **common data view** of all users.
– Describes what data is stored in database and relationships among the data.
– It is independent of any storage considerations.

The Conceptual Schema includes:
–all entities, their attributes, and their relationships;
–the constraints on the data;
–semantic information about the data;
–security and integrity information.

#### 2.外模式

External Schema （User Schema or Subschema）
– It is the **Local logical structure** of the database. It is users’ view of the database.
– Describes that part of database that is relevant to a particular user.
– Some views might include derived or calculated data. 
	*E.g. age=current_year – birth_year*

#### 3.内模式

Internal Schema （Storage schema ）
– It is physical representation of the DB on the computer. It is the **global physical structure** of the DB.
– Describes how the data is stored in the database.
– **One DB has only one Internal Schema.**

The internal level includes:
– storage space allocation for data and indexes;
– record descriptions for storage (with stored sizes for data items)
– data compression and data encryption techniques.

## 1.5数据独立性

In one word, upper levels are unaffected by changes to lower levels. It is called **data independence**.

### 1.两种类型

-Logical Data Independence
-Physical Data Independence

Data Independence is guaranteed by two-level of mapping provided by DBMS.
-external/conceptual mapping
-conceptual/ internal mapping

### 2.逻辑数据独立性

Logical Data Independence
– Refers to immunity of external schemas to changes in conceptual schema.
i.e. Conceptual schema **changes (e.g. addition/removal of entities or attributes)** should not require changes to external schema or rewrites of application programs.

Logical Data Independence is guaranteed by the mapping between external schema and conceptual schema （**external/conceptual mapping** ）.

The definition of external/conceptual mapping is described in the corresponding **subschema**. 

### 3.物理数据独立性

Physical Data Independence
– Refers to immunity of **conceptual** schema to changes in the **internal** schema.
i.e. Internal schema changes (*e.g. using different file organizations, storage structures/devices*) should not require change to conceptual or external schemas.

Physical Data Independence is guaranteed by the mapping between **conceptual** schema and **internal** schema （**conceptual/ internal mapping** ）.

The definition of conceptual/internal mapping is unique and is described in the **conceptual schema**.

<img src="D:\Typora_CACHE\image-20220521114946896.png" alt="image-20220521114946896" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521115503082.png" alt="image-20220521115503082" style="zoom:50%;" />

# 2.关系数据模型

## 1.关系数据模型

**Relational Model** is based on the mathematical concept of a relation, which is physically represented as a table.

### 1.术语

A **relation** is a table with columns and rows.
-Only applies to **logical structure** of the database,
-**not** the **physical structure** ，which we can implement using a variety of storage structures (such as a heap file or hash file).

An **attribute** is a named column of a relation.

A **domain** is the set of allowable values for one or more attributes.

A **tuple** is a row of a relation.

The **degree** (维 维 、度 度) is the number of attributes in a relation.

The **cardinality（基数）**is the number of tuples in a relation.

**Relational Database** is a collection of normalized relations with distinct *relation* names.

<img src="D:\Typora_CACHE\image-20220521164757719.png" alt="image-20220521164757719" style="zoom:50%;" />

### 2.关系模式

**Relation schema（关系模式）**
– A named relation defined by a set of attribute and domain name pairs.
– Example: *students(sno, sname, DOB)* or students(sno:*StudentNumbers*, sname: *string*, DOB: *DateOfBirth*)

Relation schema is **type**, relation is **value**.

**Relational database schema（关系数据库模式）**

– A set of all relation schemas, each with a distinct name.
Relational database schema is **type**（型）, relational database is **value**

### 3.Relational keys（关键字）

#### Superkey （超键）

– An attribute, or a set of attributes, that uniquely identifies a tuple within a relation.

#### Candidate Key（候选键）

Superkey (K) such that **no proper subset** is a superkey
	within the relation. e.g. {a, b} :{ } {a} {b}
Or A superkey that contains only the **minimum number** of columns necessary for unique **identification**.
A candidate key, K, for a relation R has two properties:
-**uniqueness** – in each tuple of R, the values of K uniquely identify that tuple;
-**rreducibility** – no proper subset of K has the uniqueness property.

#### Primary Key (PK，主键、主码 )

– Candidate key that is selected to identify tuples (records) uniquely within the relation (table).

#### Alternate Keys (AK，备用键 备用键)

– Candidate keys that are not selected to be primary key.
e.g. Branch (branchNo, street, city, Postcode)
	PK=(branchNo), AK=(street, city)
**Primary-key attribute(主属性)**
− An attribute included in any candidate key.

#### Foreign Key（ 外键 ）

– Attribute, or set of attributes, within one relation that matches candidate key of some (possibly same) relation.
e.g. Staff (staffNo, fName, lName, position, branchNo, leaderNo)

## 2.关系完整性

### 1.Null

Represents value for an attribute that is currently unknown or not applicable for tuple.
Deals with incomplete or exceptional data.
Represents the absence of a value and is **not the same as zero or spaces**, which are values.
e.g. sc ( sno, cno, grade )
	grade=0 and grade is null

### 2.实体完整性

In a base relation, **no attribute of a candidate key** can be null.
*i.e. A primary-key attribute can not be a null.*

### 3.参照完整性

If foreign key exists in a relation,
-either foreign key value must **match a candidate key value** of some tuple in its home relation or
-foreign key value must be wholly **null**.

The name of foreign key **need not be the same** with that of its referencing primary key.
e.g. S (sno, sname, age, sex)
	sc ( sno , cno, Grade ) snum **sno can not be null**

### 4.用户定义的完整性

 Additional rules specified by users or database administrators of a database that define or constrain some aspect of the enterprise..

## 3.关系代数

**Relational algebra** operations work on one or more relations to define another relation without changing the original relations.
Both operands and results are relations, so output from one operation can become input to another operation.

Five basic operations in relational algebra: **Selection, Projection, Union, Cartesian product, and Set Difference**.
These perform most of the data retrieval operations needed.
Also have **Join, Intersection, and Division** operations, which can be expressed in terms of 5 basic operations.

### 1.一元运算

#### 1.选择Selection (or Restriction)

σ predicate (R) 【Sigma】，不是 δ 【Delta】
选择行
The Selection operation works on a **single relation** R and defines a relation that contains only those tuples (rows) of R that satisfy the specified **condition** (predicate).

<img src="D:\Typora_CACHE\image-20220521170903871.png" alt="image-20220521170903871" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521173951677.png" alt="image-20220521173951677" style="zoom:50%;" />

#### 2.投影Projection

Π*col1, . . . , coln* (R)
投影列
The Projection operation works on a **single relation** R and defines a relation that contains a **vertical subset** of R, extracting the values of specified attributes and **eliminating duplicates**.

<img src="D:\Typora_CACHE\image-20220521174159798.png" alt="image-20220521174159798" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521174209329.png" alt="image-20220521174209329" style="zoom:50%;" />

### 2.集合运算

#### 1.并Union

R ∪ S
-The union of two relations R and S defines a relation that contains all the tuples of R, or S, or both R and S, **duplicate tuples being eliminated**.
-R and S must be **union-compatible**.

If R and S have I and J tuples, respectively, union is obtained by **concatenating** them into one relation with a maximum of (I + J) tuples.

Two tables must be **union compatible**.
The **numbers** of columns in two tables should be the **same**.
The corresponding **columns** should get values from the same domain.

<img src="D:\Typora_CACHE\image-20220521174429026.png" alt="image-20220521174429026" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521174444869.png" alt="image-20220521174444869" style="zoom:50%;" />

#### 2.集合差set difference

-The Set difference operation defines a relation consisting of the tuples that are in relation R, but not in S.
-R and S must be **union-compatible**.

![image-20220521174612962](D:\Typora_CACHE\image-20220521174612962.png)

<img src="D:\Typora_CACHE\image-20220521174625871.png" alt="image-20220521174625871" style="zoom:50%;" />

#### 3.交Intersection

-The Intersection operation defines a relation consisting of the set of all tuples that are in both R and S.
-R and S must be **union-compatible**.
Note that we can express the Intersection operation in terms of the Set difference operation :
*R ∩ S = R – (R – S)*

<img src="D:\Typora_CACHE\image-20220521174745330.png" alt="image-20220521174745330" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521174807096.png" alt="image-20220521174807096" style="zoom:50%;" />

#### 4. 笛卡尔积cartesian product

R × S
The Cartesian product operation defines a relation that is the concatenation of every tuple of relation R with every tuple of relation S.

The Cartesian product operation multiplies two relations to define another relation consisting of all possible pairs of tuples from the two relations.

Therefore, if one relation has **I tuples and N attributes** and the other has **J tuples and M attributes**, the Cartesian product relation will contain **(I * J) tuples with (N + M) attributes**.

It is possible that the two relations may have attributes with the same name. In this case, the attribute names are **prefixed with the relation name** to maintain the uniqueness of attribute names within a relation.

<img src="D:\Typora_CACHE\image-20220521175326940.png" alt="image-20220521175326940" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521175341137.png" alt="image-20220521175341137" style="zoom:50%;" />

### 3.连接运算

-The Join operation, which combines two relations to form a new relation, is one of the essential operations in the relational algebra.
-Join is a derivative of Cartesian product.
-It is equivalent to performing a **Selection**, using **join predicate** as selection formula, over **Cartesian product** of the two operand relations.
-Join is one of the most difficult operations to implement efficiently in an RDBMS and one reason why RDBMSs have intrinsic performance problems.

There are various forms of join operation, each with subtle differences, some more useful than others:
*Theta join (θ θ-join)*
*Equijoin (a particular type of Theta join)*
*Natural join*
*Outer join* *( Right Outer join , Left Outer join )*
*Semijoin*

#### 1.θ连接Theta join

<img src="D:\Typora_CACHE\image-20220521175815759.png" alt="image-20220521175815759" style="zoom:33%;" />

It defines a relation that contains tuples satisfying the predicate F from the Cartesian product of R and S.
The predicate F is of the form R.ai θ S.b i where θ θ may be one of the **comparison operators** (<, ≤, >, ≥, =, ≠).

We can rewrite Theta join using **basic Selection and Cartesian product** operations.
<img src="D:\Typora_CACHE\image-20220521175941697.png" alt="image-20220521175941697" style="zoom:33%;" />
 As with Cartesian product, the Degree of a Theta join is the sum of degrees of the operand relations R and S.
 In the case where the predicate F contains **only equality** (=), the term **Equijoin** is used instead.

<img src="D:\Typora_CACHE\image-20220521180012106.png" alt="image-20220521180012106" style="zoom:50%;" />

#### 2.等值连接Equijoin

<img src="D:\Typora_CACHE\image-20220521180112475.png" alt="image-20220521180112475" style="zoom:50%;" />

#### 3.自然连接Natural join

R ⋈ S
The Natural join is an **Equijoin** of the two relations R and S over **all common attributes** x.
One occurrence of each **common attribute is eliminated** from the result.
The Natural join operation performs an Equijoin **over all the attributes** in the two relations that **have the same name**.
The **degree** of a Natural join is the **sum of the degrees** of the relations R and S less the number of attributes in x.

<img src="D:\Typora_CACHE\image-20220521180327897.png" alt="image-20220521180327897" style="zoom:50%;" />

#### 4.外连接Outer join

Often in joining two relations, a tuple in one relation does not have a matching tuple in the other relation.
In other words, there is no matching value in the join attributes.
We may want tuples from one of the relations to appear in the result even when there are no matching values in the other relation.
This may be accomplished using the **Outer join**.
To display rows in the result that do not have matching values in the join column, use **Outer join**.

The Outer join is becoming more widely available in relational systems and is a specified operator in the SQL standard (see Chapter 3).
The **advantage of an Outer join** is that information is preserved, that is, the Outer join preserves tuples that would have been lost by other types of join.

**悬浮元组（Dangling tuple）**
两个关系R和S在做自然连接时，关系R中某些元组有可能在S中不存在公共属性上值相等的元组，从而造成R中这些元组在操作时被舍弃了，这些被舍弃的元组称为 悬浮元组。

如果把悬浮元组也保存在结果关系中，而在其他属性上填空值(Null)，就叫做外连接。
左外连接 外连接(LEFT OUTER JOIN或LEFT JOIN)，只保留左边关系R中的悬浮元组
右外连接(RIGHT OUTER JOIN或RIGHT JOIN)，只保留右边关系S中的悬浮元组

<img src="D:\Typora_CACHE\image-20220521180704521.png" alt="image-20220521180704521" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521180717466.png" alt="image-20220521180717466" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521180730210.png" alt="image-20220521180730210" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521180740104.png" alt="image-20220521180740104" style="zoom:50%;" />

#### 5.半连接Semijoin

<img src="D:\Typora_CACHE\image-20220521180828705.png" alt="image-20220521180828705" style="zoom:33%;" />

The **Semijoin** operation defines a relation that contains the tuples of R that participate in the join of **R** with S.
The Semijoin operation performs a join of the two relations and then projects over the attributes of the first operand.
One **advantage** of a Semijoin is that it decreases the number of tuples that need to be handled to form the join.
It is particularly useful for computing joins in distributed systems.

We can rewrite the Semijoin using the **Projection** and Join operations:
<img src="D:\Typora_CACHE\image-20220521180954435.png" alt="image-20220521180954435" style="zoom:33%;" />
where A is the set of all attributes for R.
This is actually a **Semi-Theta join**.
There are variants for **Semi-Equijoin and Semi- Natural join**.

<img src="D:\Typora_CACHE\image-20220521181006163.png" alt="image-20220521181006163" style="zoom:50%;" />

### 4.除法运算

<img src="D:\Typora_CACHE\image-20220521181025891.png" alt="image-20220521181025891" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521181034585.png" alt="image-20220521181034585" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521181045679.png" alt="image-20220521181045679" style="zoom:50%;" />

<img src="D:\Typora_CACHE\image-20220521181054414.png" alt="image-20220521181054414" style="zoom:50%;" />

# 3.SQL

## 1.SQL介绍

### 1.SQL的目的

A database language should allow a user to:
-create the database and relation structures;
-perform basic data management tasks, such as the insertion, modification, and deletion of data from the relations;
-perform both simple and complex queries.

### 2.SQL特点

**(1)SQL is a comprehensive and unifiedlanguage with 3 major components**:

1.A Data Definition Language (DDL) for defining database structure.
-Create, alter, and drop the database, relation and view structures;

2.A Data Manipulation Language (DML) for manipulating data.
-insert, delete, update and retrieve the data in DB.

3.A Data Control Language (DCL) DCL for security, integrity, transaction control
-Grant or Revoke the privilege to the
users
-ensure entity integrity, referential integrity and user-defined integrity
-Ensure the correct schedule for concurrent transactions.

**(2)SQL is relatively easy to learn:**
-It is essentially free-format.
-SQL Consists of standard English words.
-There are only 9 core command words.
	-Data query——SELECT
	-Data definition——CREATE, DROP, ALTER
	-Data manipulation——INSERT, UPDATE, DELETE
	-Data control——GRANT, REVOKE

(3) SQL is **non-procedural** - you specify whatinformation you require, rather than how to get
(4) You could use SQL in two ways: **Embedded SQL** or Interactive SQL.
(5) It must be **portable**（可移植的）

### 3.写SQL指令

<img src="D:\Typora_CACHE\image-20220526002747567.png" alt="image-20220526002747567" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526002759005.png" alt="image-20220526002759005" style="zoom:67%;" />

### 4.SQL数据类型

<img src="D:\Typora_CACHE\image-20220526113147438.png" alt="image-20220526113147438" style="zoom:67%;" />

### 5.完整性增强特性

• Consider five types of integrity constraints:
	– Required data.
	– Domain constraints (value interval).
	– Entity integrity.
	– Referential integrity.
	– Enterprise constraints(user-defined integrity).

<img src="D:\Typora_CACHE\image-20220526113256992.png" alt="image-20220526113256992" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113312173.png" alt="image-20220526113312173" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113336385.png" alt="image-20220526113336385" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113405548.png" alt="image-20220526113405548" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113415642.png" alt="image-20220526113415642" style="zoom:67%;" />

## 2.数据定义语句DDL

<img src="D:\Typora_CACHE\image-20220526113531332.png" alt="image-20220526113531332" style="zoom:67%;" />

### 1.CREATE/DROP SCHEMA（模式）

<img src="D:\Typora_CACHE\image-20220526113650398.png" alt="image-20220526113650398" style="zoom:67%;" />

### 2.CREATE TABLE

<img src="D:\Typora_CACHE\image-20220526113714057.png" alt="image-20220526113714057" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113731002.png" alt="image-20220526113731002" style="zoom:67%;" />

eg.

<img src="D:\Typora_CACHE\image-20220526114331813.png" alt="image-20220526114331813" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526114341313.png" alt="image-20220526114341313" style="zoom:67%;" />

### 3.ALTER TABLE

<img src="D:\Typora_CACHE\image-20220526113913515.png" alt="image-20220526113913515" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526113929350.png" alt="image-20220526113929350" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526114520994.png" alt="image-20220526114520994" style="zoom:67%;" />

### 4.DROP TABLE

<img src="D:\Typora_CACHE\image-20220526114110116.png" alt="image-20220526114110116" style="zoom:67%;" />

### 5.INDEX

<img src="D:\Typora_CACHE\image-20220526114134599.png" alt="image-20220526114134599" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526114156663.png" alt="image-20220526114156663" style="zoom:67%;" />

eg.

<img src="D:\Typora_CACHE\image-20220526114242533.png" alt="image-20220526114242533" style="zoom:67%;" />

### 6.DROP INDEX

<img src="D:\Typora_CACHE\image-20220526115820324.png" alt="image-20220526115820324" style="zoom:67%;" />

## 3.数据查询语句 QUERY

### 1.SELECT

<img src="D:\Typora_CACHE\image-20220526120657735.png" alt="image-20220526120657735" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526120707075.png" alt="image-20220526120707075" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526120722228.png" alt="image-20220526120722228" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214245533.png" alt="image-20220526214245533" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214256154.png" alt="image-20220526214256154" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214320079.png" alt="image-20220526214320079" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214335028.png" alt="image-20220526214335028" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214425888.png" alt="image-20220526214425888" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214439610.png" alt="image-20220526214439610" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214455403.png" alt="image-20220526214455403" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214506166.png" alt="image-20220526214506166" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214552388.png" alt="image-20220526214552388" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214602456.png" alt="image-20220526214602456" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214623253.png" alt="image-20220526214623253" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214643787.png" alt="image-20220526214643787" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526214705111.png" alt="image-20220526214705111" style="zoom:67%;" />

![image-20220526214918353](D:\Typora_CACHE\image-20220526214918353.png)

<img src="D:\Typora_CACHE\image-20220526215001084.png" alt="image-20220526215001084" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215033716.png" alt="image-20220526215033716" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215136058.png" alt="image-20220526215136058" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215238687.png" alt="image-20220526215238687" style="zoom: 67%;" />

<img src="D:\Typora_CACHE\image-20220526215443660.png" alt="image-20220526215443660" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215716247.png" alt="image-20220526215716247" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215750270.png" alt="image-20220526215750270" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215806518.png" alt="image-20220526215806518" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215841339.png" alt="image-20220526215841339" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526215920558.png" alt="image-20220526215920558" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526220029679.png" alt="image-20220526220029679" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526220052791.png" alt="image-20220526220052791" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222016008.png" alt="image-20220526222016008" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222031767.png" alt="image-20220526222031767" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222437550.png" alt="image-20220526222437550" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222447375.png" alt="image-20220526222447375" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222527872.png" alt="image-20220526222527872" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222542715.png" alt="image-20220526222542715" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526222616576.png" alt="image-20220526222616576" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230609881.png" alt="image-20220526230609881" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230624222.png" alt="image-20220526230624222" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230638600.png" alt="image-20220526230638600" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230649411.png" alt="image-20220526230649411" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230708397.png" alt="image-20220526230708397" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230720390.png" alt="image-20220526230720390" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230733875.png" alt="image-20220526230733875" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230752795.png" alt="image-20220526230752795" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220526230808649.png" alt="image-20220526230808649" style="zoom:67%;" />

## 4.数据操作语句DML

### 1.INSERT

<img src="D:\Typora_CACHE\image-20220617210931028.png" alt="image-20220617210931028" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617210953952.png" alt="image-20220617210953952" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617211219187.png" alt="image-20220617211219187" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617211435641.png" alt="image-20220617211435641" style="zoom:67%;" />



### 2.UPDATE

<img src="D:\Typora_CACHE\image-20220617211637788.png" alt="image-20220617211637788" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617211713045.png" alt="image-20220617211713045" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617211810750.png" alt="image-20220617211810750" style="zoom:67%;" />

### 3.DELETE

<img src="D:\Typora_CACHE\image-20220617211831766.png" alt="image-20220617211831766" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617211845749.png" alt="image-20220617211845749" style="zoom:67%;" />

## 5.视图

<img src="D:\Typora_CACHE\image-20220617211939350.png" alt="image-20220617211939350" style="zoom:67%;" />

### 1.CREATE VIEW

<img src="D:\Typora_CACHE\image-20220617211950186.png" alt="image-20220617211950186" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617212010486.png" alt="image-20220617212010486" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617212025051.png" alt="image-20220617212025051" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617212053304.png" alt="image-20220617212053304" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617212113822.png" alt="image-20220617212113822" style="zoom:67%;" />

### 2.DROP VIEW

<img src="D:\Typora_CACHE\image-20220617212313716.png" alt="image-20220617212313716" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617212333393.png" alt="image-20220617212333393" style="zoom:67%;" />

CASCADE 级联删除，RESTRICT 若有外键，则拒绝删除

### 3.视图分解View Resolution

#### 1.视图分解

视图上的任何操作都自动转换为派生关系的操作。

<img src="D:\Typora_CACHE\image-20220617213023562.png" alt="image-20220617213023562" style="zoom:67%;" />

#### 2.视图的限制

<img src="D:\Typora_CACHE\image-20220617220359671.png" alt="image-20220617220359671" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617220414515.png" alt="image-20220617220414515" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617220433265.png" alt="image-20220617220433265" style="zoom:67%;" />

#### 3.视图的可更新性

<img src="D:\Typora_CACHE\image-20220617220755524.png" alt="image-20220617220755524" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617220815198.png" alt="image-20220617220815198" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617220845877.png" alt="image-20220617220845877" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617220911826.png" alt="image-20220617220911826" style="zoom:67%;" />

为了使视图可更新，**ＤＢＭＳ**必须具有以下能力： 对于任何一个行或列都能追溯到其源表中相应的 行或列。

#### 4.With Check Option

<img src="D:\Typora_CACHE\image-20220617224955993.png" alt="image-20220617224955993" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617225118573.png" alt="image-20220617225118573" style="zoom:67%;" />

WITH CHECK OPTION has no affect on Source Table.

## 6.编程SQL

<img src="D:\Typora_CACHE\image-20220617225146677.png" alt="image-20220617225146677" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617225206476.png" alt="image-20220617225206476" style="zoom:67%;" />

### 1.PSM（persistent stored modules）

<img src="D:\Typora_CACHE\image-20220617231434304.png" alt="image-20220617231434304" style="zoom:80%;" />

Stored procedures和trigger应该不考吧

### 2.Embedded SQL

<img src="D:\Typora_CACHE\image-20220617231528820.png" alt="image-20220617231528820" style="zoom:67%;" />

### 3.API

<img src="D:\Typora_CACHE\image-20220617231638821.png" alt="image-20220617231638821" style="zoom: 67%;" />

# 4.关系数据理论

## 1.问题Problems

### 1.数据冗余Data Redundancy

<img src="D:\Typora_CACHE\image-20220617232113869.png" alt="image-20220617232113869" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617232124097.png" alt="image-20220617232124097" style="zoom:67%;" />

### 2.更新异常Update Anomalies

<img src="D:\Typora_CACHE\image-20220617232156099.png" alt="image-20220617232156099" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220617232254639.png" alt="image-20220617232254639" style="zoom:67%;" />



## 2.函数依赖Functional Dependency

<img src="D:\Typora_CACHE\image-20220619100537385.png" alt="image-20220619100537385" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619100648762.png" alt="image-20220619100648762" style="zoom:67%;" />

**如何确定候选键**

**给出依赖集**
不出现在依赖中，不在箭头右侧，唯一确定单独的元组

<img src="D:\Typora_CACHE\image-20220619100714494.png" alt="image-20220619100714494" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619100723118.png" alt="image-20220619100723118" style="zoom:67%;" />

**未给出依赖集**
若所有元组都是候选键，那么叫做FULL KEY

<img src="D:\Typora_CACHE\image-20220619101245039.png" alt="image-20220619101245039" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619101431575.png" alt="image-20220619101431575" style="zoom:67%;" />

## 3.Armstrong‘s axioms

三条推理规则：

1. 自反。自身可以确定自身，集合本身就具有不重复性，平凡函数，自己顶自己。
2. 增广。用Z将原来的函数特殊化，左右同时增加属性依然成立。XZ推YZ可能是完全依赖XZ也可以推出Y，但是这就是部分依赖了。
3. 传递。不区分XY是否单向，所以最后可能是一一对应，也可能是多对一
   <img src="D:\Typora_CACHE\image-20220619101701348.png" alt="image-20220619101701348" style="zoom:67%;" />

三条推论：

1. 合成规则。可以将同一条件得出的两个结论合并。

2. 分解规则。可以将一个结论分解成多个结论。

3. 伪传递规则。

   <img src="D:\Typora_CACHE\image-20220619101712492.png" alt="image-20220619101712492" style="zoom:67%;" />

**闭包**

在关系模式R  中为F 所逻辑蕴含的函 数依赖的全体叫作F 的闭包（closure），记 为F +

具体算法如下：

1. 用自己作为初值（自反）之后迭代
2. 每一次迭代，用当前拥有的条件推结果，将结果中新的部分加入条件集
3. 直到不再产生新的结果

<img src="D:\Typora_CACHE\image-20220619103105202.png" alt="image-20220619103105202" style="zoom:67%;" />

**最小依赖集**

怎么算就要从最小依赖集特性入手：

1. 右边都是单属性
2. 没有多余的函数依赖。如果一个函数依赖可以被剩余部分导出，说明多余。
3. 左边没有多余属性。
4. 拆分单属性。
5. 去掉多余依赖。逐个去掉，用属性闭包测试是否可以用X推出Y，如果能导出，就多余，注意，如果去掉了，就直接去掉就OK，因为总是等价的，后面可以用新的集合判断。这也就能解释为什么最小依赖不唯一，因为你去掉的顺序不一样。
   3 缩减部分依赖。看看将某个属性缩减后，缩减后依赖是否属于集合。比如将AB变成A或者B，看看能否导出结果，能导出就说明可以缩减，只需要一部分就可以导出结果。

<img src="D:\Typora_CACHE\image-20220619103601349.png" alt="image-20220619103601349" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619103636942.png" alt="image-20220619103636942" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619104035944.png" alt="image-20220619104035944" style="zoom:67%;" />

**函数依赖集的等价性**

<img src="D:\Typora_CACHE\image-20220619111520993.png" alt="image-20220619111520993" style="zoom: 67%;" />

<img src="D:\Typora_CACHE\image-20220619111602540.png" alt="image-20220619111602540" style="zoom:67%;" />





## 4.规范化过程The Process of Normalization

### 1.范式的定义

<img src="D:\Typora_CACHE\image-20220619112534605.png" alt="image-20220619112534605" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619112557230.png" alt="image-20220619112557230" style="zoom:67%;" />

### 2.规范化定义

<img src="D:\Typora_CACHE\image-20220619112732271.png" alt="image-20220619112732271" style="zoom:67%;" />

### 3.模式分解的标准

规范化就是模式分解的过程，模式分解就是将列拆分，重构成为两个新关系。最终目的是**减少数据冗余**以及提高性能。

模式分解有两个指标：

1. **无损连接分解**。分解后的表进行自然连接，结果和原表一样。
   <img src="D:\Typora_CACHE\image-20220619114256634.png" alt="image-20220619114256634" style="zoom:67%;" />
   
   
   
   <img src="D:\Typora_CACHE\image-20220619155345848.png" alt="image-20220619155345848" style="zoom:150%;" />
   <img src="D:\Typora_CACHE\image-20220619155427940.png" alt="image-20220619155427940" style="zoom:67%;" />
   
   https://www.bilibili.com/video/BV1jV411Y7Cx步骤讲解
   画表循环判断
   ![image-20220619121452006](D:\Typora_CACHE\image-20220619121452006.png)
   
2. **保持函数依赖**。判断标准用函数依赖集等价判断，但是这个并不一定能保证，实际中有的函数依赖没意义也不需要保持。有的则需要保持来减轻异常。

### 4.UNF&1NF&2NF

1. 1NF。特征是属性不可分割。这是基本要求
2. 2NF。特征是候选键到非主属性没有冗余属性。做法是将候选键到非主属性的部分函数依赖全部变成完全函数依赖。

![image-20220619124303204](D:\Typora_CACHE\image-20220619124303204.png)

### 5.3NF&BCNF

1. 3NF。特征是不存在因为传递引起的冗余。做法是将传递函数依赖都去掉。
2. BCNF。特征是候选键内部一一对应，所有依赖都可以用候选键作为起点。做法是将候选键内部的部分依赖去掉。BCNF是函数依赖范畴内的最优结果。

# 5.数据库设计

## 1.数据库研发生命周期

<img src="D:\Typora_CACHE\image-20220619130652920.png" alt="image-20220619130652920" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619130719454.png" alt="image-20220619130719454" style="zoom:67%;" />



## 2.ER模型

<img src="D:\Typora_CACHE\image-20220619130736926.png" alt="image-20220619130736926" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619130757769.png" alt="image-20220619130757769" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619130821428.png" alt="image-20220619130821428" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619130947928.png" alt="image-20220619130947928" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131011891.png" alt="image-20220619131011891" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131021312.png" alt="image-20220619131021312" style="zoom:67%;" />

## 3.加强ER模型

<img src="D:\Typora_CACHE\image-20220619131136247.png" alt="image-20220619131136247" style="zoom:67%;" />



## 4.ER模型到关系模型的规范

<img src="D:\Typora_CACHE\image-20220619131242991.png" alt="image-20220619131242991" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131348777.png" alt="image-20220619131348777" style="zoom:67%;" />

# 6.数据库安全

## 1.概念

<img src="D:\Typora_CACHE\image-20220619131509355.png" alt="image-20220619131509355" style="zoom:67%;" />

## 2.权限

<img src="D:\Typora_CACHE\image-20220619131517390.png" alt="image-20220619131517390" style="zoom:67%;" />

## 3.赋予权限

<img src="D:\Typora_CACHE\image-20220619131533081.png" alt="image-20220619131533081" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131549352.png" alt="image-20220619131549352" style="zoom:67%;" />

## 4.收回权限

<img src="D:\Typora_CACHE\image-20220619131604236.png" alt="image-20220619131604236" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131615275.png" alt="image-20220619131615275" style="zoom:67%;" />

# 7.并发控制

## 1.传输的概念和特征

<img src="D:\Typora_CACHE\image-20220619131825297.png" alt="image-20220619131825297" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131849216.png" alt="image-20220619131849216" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619131912908.png" alt="image-20220619131912908" style="zoom:67%;" />

## 2.由并发引发的三个潜在问题

**丢失更新**<img src="D:\Typora_CACHE\image-20220619131951598.png" alt="image-20220619131951598" style="zoom:67%;" />

**读脏数据**<img src="D:\Typora_CACHE\image-20220619132015902.png" alt="image-20220619132015902" style="zoom:67%;" />

**不一致分析问题**<img src="D:\Typora_CACHE\image-20220619132054517.png" alt="image-20220619132054517" style="zoom:67%;" />

## 3.可串行化

<img src="D:\Typora_CACHE\image-20220619132110001.png" alt="image-20220619132110001" style="zoom:67%;" />



## 4.二阶段封锁

<img src="D:\Typora_CACHE\image-20220619132134237.png" alt="image-20220619132134237" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132148410.png" alt="image-20220619132148410" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132206157.png" alt="image-20220619132206157" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132324675.png" alt="image-20220619132324675" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132410285.png" alt="image-20220619132410285" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132427049.png" alt="image-20220619132427049" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132435048.png" alt="image-20220619132435048" style="zoom:67%;" /



## 5.隔离等级

从粗到细

<img src="D:\Typora_CACHE\image-20220619132458852.png" alt="image-20220619132458852" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132524348.png" alt="image-20220619132524348" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132558346.png" alt="image-20220619132558346" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132611931.png" alt="image-20220619132611931" style="zoom:67%;" />

# 8.数据库恢复

## 1.失败

<img src="D:\Typora_CACHE\image-20220619132721305.png" alt="image-20220619132721305" style="zoom:67%;" />

## 2.会话与恢复

<img src="D:\Typora_CACHE\image-20220619132738076.png" alt="image-20220619132738076" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132746793.png" alt="image-20220619132746793" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132757940.png" alt="image-20220619132757940" style="zoom:67%;" />

## 3.恢复机制

<img src="D:\Typora_CACHE\image-20220619132807265.png" alt="image-20220619132807265" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132827228.png" alt="image-20220619132827228" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132842155.png" alt="image-20220619132842155" style="zoom:67%;" />

## 4.恢复技术

<img src="D:\Typora_CACHE\image-20220619132900491.png" alt="image-20220619132900491" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132912070.png" alt="image-20220619132912070" style="zoom:67%;" />

<img src="D:\Typora_CACHE\image-20220619132922794.png" alt="image-20220619132922794" style="zoom:67%;" />

