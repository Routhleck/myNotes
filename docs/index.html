<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>myNotes · 课程笔记中心</title>
    <meta
      name="description"
      content="北京交通大学软件工程课程笔记、课件与项目资料的一站式浏览体验。"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <style>
      :root {
        color-scheme: light dark;
        --page-width: 1080px;
        --bg-light-1: #f5f6f8;
        --bg-light-2: #ffffff;
        --bg-light-3: #e8eaed;
        --bg-dark-1: #000000;
        --bg-dark-2: #1c1c1e;
        --surface-light: rgba(255, 255, 255, 0.75);
        --surface-dark: rgba(28, 28, 30, 0.78);
        --accent: #0071e3;
        --accent-dark: #2997ff;
        --warning: #ff9500;
        --text-primary-light: #1d1d1f;
        --text-secondary-light: #515154;
        --text-primary-dark: #f5f5f7;
        --text-secondary-dark: #a1a1a6;
        --border-light: rgba(15, 18, 25, 0.06);
        --border-dark: rgba(255, 255, 255, 0.08);
        --shadow-light: 0 30px 60px rgba(9, 18, 31, 0.08);
        --shadow-light-hover: 0 40px 80px rgba(9, 18, 31, 0.12);
        --shadow-dark: 0 30px 60px rgba(0, 0, 0, 0.45);
        --shadow-dark-hover: 0 40px 90px rgba(0, 0, 0, 0.6);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", "Segoe UI", sans-serif;
      }

      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(140deg, var(--bg-light-1) 0%, var(--bg-light-2) 40%, var(--bg-light-3) 100%);
        color: var(--text-primary-light);
      }

      header {
        padding: 64px 24px 48px;
      }

      .hero {
        max-width: var(--page-width);
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .hero__eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 24px;
        background: rgba(0, 113, 227, 0.12);
        color: var(--accent);
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        width: fit-content;
      }

      .hero__eyebrow::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent);
      }

      .hero__headline {
        margin: 0;
        font-size: clamp(2.5rem, 6vw, 3.3rem);
        letter-spacing: -0.02em;
        font-weight: 600;
      }

      .hero__copy {
        margin: 0;
        font-size: 1.05rem;
        color: var(--text-secondary-light);
        max-width: 680px;
        line-height: 1.6;
      }

      .hero__panel {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
      }

      .filter-group {
        display: inline-flex;
        gap: 4px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.65);
        border: 1px solid var(--border-light);
        backdrop-filter: blur(22px);
      }

      .filter-btn {
        border: none;
        background: transparent;
        color: var(--text-secondary-light);
        padding: 10px 18px;
        border-radius: 999px;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 180ms ease, color 180ms ease, box-shadow 180ms ease;
      }

      .filter-btn.active {
        background: var(--accent);
        color: #fff;
        box-shadow: 0 10px 25px rgba(0, 113, 227, 0.25);
      }

      .filter-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .search-field {
        position: relative;
        flex: 1;
        min-width: 220px;
        max-width: 320px;
      }

      .search-field input {
        width: 100%;
        padding: 12px 44px 12px 16px;
        border-radius: 14px;
        border: 1px solid var(--border-light);
        background: rgba(255, 255, 255, 0.85);
        font-size: 0.95rem;
        transition: border 180ms ease, box-shadow 180ms ease;
      }

      .search-field input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.12);
      }

      .search-field svg {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 18px;
        height: 18px;
        stroke: var(--text-secondary-light);
        opacity: 0.72;
        pointer-events: none;
      }

      main {
        flex: 1;
        width: 100%;
        padding: 0 24px 80px;
      }

      .section {
        max-width: var(--page-width);
        margin: 0 auto;
      }

      .section-title {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 16px;
        margin-bottom: 32px;
        border-bottom: 1px solid var(--border-light);
        padding-bottom: 16px;
      }

      .section-title h2 {
        font-size: 1.4rem;
        margin: 0;
        letter-spacing: -0.01em;
      }

      .result-meta {
        font-size: 0.9rem;
        color: var(--text-secondary-light);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 24px;
      }

      .course-card {
        position: relative;
        padding: 28px;
        background: var(--surface-light);
        border-radius: 28px;
        border: 1px solid var(--border-light);
        box-shadow: var(--shadow-light);
        display: flex;
        flex-direction: column;
        gap: 18px;
        transition: transform 220ms ease, box-shadow 220ms ease;
      }

      .course-card:hover {
        transform: translateY(-6px);
        box-shadow: var(--shadow-light-hover);
      }

      .course-card h3 {
        margin: 0;
        font-size: 1.2rem;
        letter-spacing: -0.01em;
      }

      .course-card p {
        margin: 0;
        font-size: 0.95rem;
        color: var(--text-secondary-light);
        line-height: 1.6;
      }

      .badge {
        position: absolute;
        top: 24px;
        right: 24px;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--accent);
      }

      .status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        border-radius: 24px;
        padding: 6px 12px;
        background: rgba(0, 113, 227, 0.12);
        color: var(--accent);
        font-weight: 600;
        letter-spacing: 0.05em;
        width: fit-content;
      }

      .status::before {
        content: "";
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent);
      }

      .status--updating {
        background: rgba(255, 149, 0, 0.14);
        color: var(--warning);
      }

      .status--updating::before {
        background: var(--warning);
      }

      .link-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .link-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        font-size: 0.95rem;
      }

      .link-action {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: inherit;
        text-decoration: none;
        border: none;
        background: none;
        padding: 0;
        cursor: pointer;
        font: inherit;
        transition: color 160ms ease;
      }

      .link-action:hover {
        color: var(--accent);
      }

      .tag {
        flex-shrink: 0;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        background: rgba(0, 113, 227, 0.12);
        color: var(--accent);
      }

      .tag--pdf {
        background: rgba(109, 200, 84, 0.18);
        color: #2ba44f;
      }

      .tag--ppt {
        background: rgba(255, 214, 10, 0.2);
        color: #b77900;
      }

      .tag--html {
        background: rgba(175, 82, 222, 0.16);
        color: #af52de;
      }

      .empty-state {
        margin-top: 48px;
        padding: 36px;
        text-align: center;
        border: 1px dashed var(--border-light);
        border-radius: 24px;
        color: var(--text-secondary-light);
        font-size: 0.95rem;
      }

      footer {
        margin-top: auto;
        padding: 40px 24px 48px;
        color: var(--text-secondary-light);
      }

      .footer-content {
        max-width: var(--page-width);
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: space-between;
        font-size: 0.85rem;
      }

      .viewer-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(12px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px;
        z-index: 1000;
      }

      .viewer-dialog {
        position: relative;
        width: min(1200px, 100%);
        height: min(90vh, 760px);
        background: rgba(18, 18, 18, 0.92);
        border-radius: 28px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 30px 70px rgba(0, 0, 0, 0.3);
      }

      .viewer-frame {
        width: 100%;
        height: 100%;
        border: none;
        background: #000;
      }

      .viewer-header {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #f5f5f7;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0) 100%);
        pointer-events: none;
      }

      .viewer-title {
        margin: 0;
        font-size: 1rem;
        font-weight: 500;
        letter-spacing: -0.01em;
      }

      .viewer-close {
        position: relative;
        pointer-events: auto;
        border: none;
        background: rgba(255, 255, 255, 0.16);
        color: #fff;
        border-radius: 999px;
        padding: 8px 18px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 160ms ease;
      }

      .viewer-close:hover {
        background: rgba(255, 255, 255, 0.28);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      @supports (backdrop-filter: blur(20px)) {
        .course-card {
          backdrop-filter: blur(24px);
        }
        .filter-group {
          backdrop-filter: blur(16px);
        }
        .search-field input {
          backdrop-filter: blur(12px);
        }
      }

      @media (prefers-color-scheme: dark) {
        body {
          background: radial-gradient(circle at 20% 20%, var(--bg-dark-2), var(--bg-dark-1) 60%);
          color: var(--text-primary-dark);
        }

        header {
          background: linear-gradient(160deg, rgba(37, 37, 41, 0.85), rgba(14, 14, 16, 0.95));
        }

        .hero__copy,
        .result-meta,
        .course-card p,
        .footer-content {
          color: var(--text-secondary-dark);
        }

        .filter-group {
          background: rgba(28, 28, 30, 0.85);
          border-color: var(--border-dark);
        }

        .filter-btn {
          color: var(--text-secondary-dark);
        }

        .filter-btn.active {
          background: var(--accent-dark);
        }

        .search-field input {
          background: rgba(28, 28, 30, 0.85);
          border-color: var(--border-dark);
          color: var(--text-primary-dark);
        }

        .search-field svg {
          stroke: var(--text-secondary-dark);
        }

        .section-title {
          border-color: var(--border-dark);
        }

        .course-card {
          background: var(--surface-dark);
          border-color: var(--border-dark);
          box-shadow: var(--shadow-dark);
        }

        .course-card:hover {
          box-shadow: var(--shadow-dark-hover);
        }

        .tag--pdf {
          background: rgba(52, 199, 89, 0.28);
          color: #3ce270;
        }

        .tag--ppt {
          background: rgba(255, 214, 10, 0.28);
          color: #ffd60a;
        }

        .tag--html {
          background: rgba(175, 82, 222, 0.26);
          color: #d5b5ff;
        }

        .empty-state {
          border-color: var(--border-dark);
          color: var(--text-secondary-dark);
        }
      }

      @media (max-width: 720px) {
        header {
          padding: 48px 20px 32px;
        }

        main {
          padding: 0 20px 56px;
        }

        .hero__panel {
          flex-direction: column;
          align-items: stretch;
        }

        .filter-group {
          width: 100%;
          justify-content: space-between;
        }

        .filter-btn {
          flex: 1;
          text-align: center;
        }

        .badge {
          position: static;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <noscript>需要开启 JavaScript 才能浏览课程资源。</noscript>
    <div id="root"></div>

    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    <script type="module">
      import React from 'https://esm.sh/react@18.3.1';
      import ReactDOM from 'https://esm.sh/react-dom@18.3.1/client';
      window.React = React;
      window.ReactDOM = ReactDOM;
    </script>
    <script defer type="text/babel" data-presets="react,env">
      const FILTERS = [
        { key: 'all', label: '全部' },
        { key: 'freshman', label: '大一' },
        { key: 'sophomore', label: '大二' },
        { key: 'junior', label: '大三' },
        { key: 'extra', label: '拓展' },
      ];

      function createAbsoluteURL(path) {
        try {
          return new URL(path, window.location.href).href;
        } catch (error) {
          return path;
        }
      }

      function buildViewerURL(resource) {
        if (!resource) return null;
        const absolute = createAbsoluteURL(resource.href);
        if (resource.kind === 'pdf') {
          return `${absolute}#toolbar=0&view=fitH`;
        }
        if (resource.kind === 'ppt') {
          const encoded = encodeURIComponent(absolute);
          return `https://view.officeapps.live.com/op/embed.aspx?src=${encoded}`;
        }
        return null;
      }

      function getTagClass(kind) {
        if (kind === 'pdf') return 'tag tag--pdf';
        if (kind === 'ppt') return 'tag tag--ppt';
        return 'tag tag--html';
      }

      function getStatusClass(status) {
        return status === 'updating' ? 'status status--updating' : 'status';
      }

      function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }

      const { useEffect, useMemo, useState } = React;

      function App() {
        const [courses, setCourses] = useState([]);
        const [loading, setLoading] = useState(true);
        const [loadError, setLoadError] = useState(null);
        const [activeFilter, setActiveFilter] = useState('all');
        const [query, setQuery] = useState('');
        const [viewerResource, setViewerResource] = useState(null);

        useEffect(() => {
          let cancelled = false;
          async function loadCourses() {
            try {
              const response = await fetch('data/courses.json', { cache: 'no-store' });
              if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
              }
              const payload = await response.json();
              if (!cancelled) {
                setCourses(Array.isArray(payload) ? payload : []);
                setLoadError(null);
              }
            } catch (error) {
              if (!cancelled) {
                console.error('读取课程数据失败', error);
                setLoadError('无法读取课程数据');
                setCourses([]);
              }
            } finally {
              if (!cancelled) {
                setLoading(false);
              }
            }
          }
          loadCourses();
          return () => {
            cancelled = true;
          };
        }, []);

        const filteredCourses = useMemo(() => {
          if (loading || loadError) {
            return [];
          }
          const lower = query.trim().toLowerCase();
          return courses.filter((course) => {
            const matchesFilter = activeFilter === 'all' || course.grade === activeFilter;
            if (!matchesFilter) {
              return false;
            }
            if (!lower) {
              return true;
            }
            const pool = [
              course.title,
              course.description,
              ...(course.keywords || []),
              ...(course.resources || []).map((res) => res.label),
            ]
              .join(' ')
              .toLowerCase();
            return pool.includes(lower);
          });
        }, [activeFilter, query, courses, loading, loadError]);

        const totalCourses = courses.length;
        const resultSummary = loading
          ? '正在加载课程…'
          : loadError
          ? '课程数据加载失败'
          : `显示 ${filteredCourses.length} / ${totalCourses} 门课程`;

        function handleResourceClick(resource) {
          if (!resource) return;
          if (resource.kind === 'pdf' || resource.kind === 'ppt') {
            setViewerResource(resource);
          } else {
            window.open(resource.href, '_blank', 'noopener');
          }
        }

        function closeViewer() {
          setViewerResource(null);
        }

        useEffect(() => {
          const onKeydown = (event) => {
            if (event.key === '/' && document.activeElement !== document.querySelector('[data-search]')) {
              event.preventDefault();
              const input = document.querySelector('[data-search]');
              input?.focus();
            }
            if (event.key === 'Escape' && viewerResource) {
              closeViewer();
            }
          };
          document.addEventListener('keydown', onKeydown);
          return () => document.removeEventListener('keydown', onKeydown);
        }, [viewerResource]);

        const viewerUrl = buildViewerURL(viewerResource);

        return (
          <>
            <header>
              <div className="hero">
                <span className="hero__eyebrow">笔记中心</span>
                <h1 className="hero__headline">北京交通大学软件工程课程笔记</h1>
                <p className="hero__copy">
                  从大一到大三的课程资料、复习提纲与实训项目，在这里一站式浏览。使用下方的筛选与搜索快速定位所需内容，或直接打开对应的 PDF / HTML / PPT 笔记开始学习。
                </p>
                <div className="hero__panel">
                  <div className="filter-group" role="tablist" aria-label="年级筛选">
                    {FILTERS.map((filter) => (
                      <button
                        key={filter.key}
                        type="button"
                        className={`filter-btn ${activeFilter === filter.key ? 'active' : ''}`}
                        onClick={() => setActiveFilter(filter.key)}
                      >
                        {filter.label}
                      </button>
                    ))}
                  </div>
                  <label className="search-field">
                    <span className="sr-only">搜索课程</span>
                    <input
                      type="search"
                      placeholder="搜索课程或关键词"
                      autoComplete="off"
                      data-search
                      value={query}
                      onChange={(event) => setQuery(event.target.value)}
                    />
                    <svg viewBox="0 0 24 24" fill="none" strokeWidth="1.5">
                      <circle cx="11" cy="11" r="7"></circle>
                      <line x1="16.5" y1="16.5" x2="21" y2="21"></line>
                    </svg>
                  </label>
                </div>
              </div>
            </header>

            <main>
              <section className="section" aria-labelledby="courses">
                <div className="section-title">
                  <h2 id="courses">课程总览</h2>
                  <span className="result-meta">{resultSummary}</span>
                </div>
                {loading ? (
                  <div className="empty-state">课程数据加载中…</div>
                ) : loadError ? (
                  <div className="empty-state">课程数据加载失败，请刷新后重试。</div>
                ) : filteredCourses.length === 0 ? (
                  <div className="empty-state">未找到匹配的内容，请尝试更换筛选条件或关键词。</div>
                ) : (
                  <div className="grid" id="course-grid">
                    {filteredCourses.map((course) => (
                      <article
                        key={course.id}
                        className="course-card"
                        data-grade={course.grade}
                        data-keywords={course.keywords?.join(' ') || ''}
                      >
                        <span className="badge">{FILTERS.find((f) => f.key === course.grade)?.label || capitalize(course.grade)}</span>
                        <h3>{course.title}</h3>
                        {course.status === 'updating' && (
                          <span className="status status--updating">更新中</span>
                        )}
                        <p>{course.description}</p>
                        <ul className="link-list">
                          {(course.resources || []).map((resource) => (
                            <li key={resource.id} className="link-item">
                              <button
                                type="button"
                                className="link-action"
                                onClick={() => handleResourceClick(resource)}
                                aria-label={`${resource.label}${resource.kind !== 'html' ? '（内嵌预览）' : '（新窗口打开）'}`}
                              >
                                {resource.label}
                              </button>
                              <span className={getTagClass(resource.kind)}>{resource.kind.toUpperCase()}</span>
                            </li>
                          ))}
                        </ul>
                      </article>
                    ))}
                  </div>
                )}
              </section>
            </main>

            <footer>
              <div className="footer-content">
                <span>© {new Date().getFullYear()} myNotes · 持续更新，欢迎关注。</span>
                <span>建议使用桌面浏览器或 iPad 横屏体验最佳效果。</span>
              </div>
            </footer>

            {viewerResource && viewerUrl && (
              <div className="viewer-backdrop" role="dialog" aria-modal="true">
                <div className="viewer-dialog">
                  <div className="viewer-header">
                    <h3 className="viewer-title">{viewerResource.label}</h3>
                    <button type="button" className="viewer-close" onClick={closeViewer}>
                      关闭
                    </button>
                  </div>
                  <iframe
                    title={viewerResource.label}
                    src={viewerUrl}
                    className="viewer-frame"
                    loading="lazy"
                  ></iframe>
                </div>
              </div>
            )}
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
